/**
 * ğŸµ YesPlayMusic Electron å¿«é€Ÿç™»å½•è„šæœ¬
 *
 * ä½¿ç”¨æ–¹æ³•ï¼š
 * 1. æ‰“å¼€ Electron åº”ç”¨
 * 2. æŒ‰ Cmd+Option+I (Mac) æˆ– Ctrl+Shift+I (Windows) æ‰“å¼€ DevTools
 * 3. åˆ‡æ¢åˆ° Console æ ‡ç­¾
 * 4. å°†ä¸‹é¢çš„ MUSIC_U æ›¿æ¢ä¸ºä½ çš„ Cookie
 * 5. å¤åˆ¶æ•´ä¸ªè„šæœ¬ç²˜è´´åˆ°æ§åˆ¶å°æŒ‰å›è½¦
 */

(async () => {
  // ==================== é…ç½®åŒº ====================
  // æ›¿æ¢ä¸ºä½ çš„ MUSIC_U Cookie å€¼
  const MUSIC_U =
    '';
  // ================================================

  console.log(
    '%cğŸµ YesPlayMusic ç™»å½•åŠ©æ‰‹',
    'color: #335eea; font-size: 20px; font-weight: bold;'
  );
  console.log('%cå¼€å§‹ç™»å½•æµç¨‹...', 'color: #42b883; font-size: 14px;');

  if (!MUSIC_U || MUSIC_U.length < 50) {
    console.error(
      '%câŒ é”™è¯¯: MUSIC_U Cookie æ— æ•ˆæˆ–æœªè®¾ç½®',
      'color: red; font-size: 14px;'
    );
    console.log(
      '%cğŸ’¡ è¯·å°†è„šæœ¬ä¸­çš„ MUSIC_U æ›¿æ¢ä¸ºä½ è‡ªå·±çš„ Cookie',
      'color: orange;'
    );
    return;
  }

  // 1. ä¿å­˜ Cookie
  console.log('ğŸ“ [1/3] ä¿å­˜ Cookie...');
  localStorage.setItem('MUSIC_U', MUSIC_U);
  localStorage.setItem('cookie-MUSIC_U', MUSIC_U);
  console.log('âœ… Cookie å·²ä¿å­˜åˆ° localStorage');

  // 2. æµ‹è¯• API
  console.log('ğŸŒ [2/3] éªŒè¯ç™»å½•çŠ¶æ€...');
  try {
    const apiUrl = `/api/user/account?timestamp=${Date.now()}`;
    console.log('   è¯·æ±‚åœ°å€:', apiUrl);

    const response = await fetch(apiUrl, {
      credentials: 'include',
    });

    if (!response.ok) {
      throw new Error(`HTTP ${response.status}: ${response.statusText}`);
    }

    const data = await response.json();
    console.log('   å“åº”æ•°æ®:', data);

    if (data.code === 200 && data.profile) {
      console.log(
        '%câœ… ç™»å½•æˆåŠŸ!',
        'color: green; font-size: 16px; font-weight: bold;'
      );
      console.log(
        `%cğŸ‘¤ æ¬¢è¿: ${data.profile.nickname}`,
        'color: #335eea; font-size: 14px;'
      );
      console.log(`   ç”¨æˆ·ID: ${data.account.id}`);
      console.log(`   VIPç±»å‹: ${data.account.vipType}`);

      // 3. ä¿å­˜ç”¨æˆ·ä¿¡æ¯
      console.log('ğŸ’¾ [3/3] ä¿å­˜ç”¨æˆ·ä¿¡æ¯...');
      const oldData = JSON.parse(localStorage.getItem('data') || '{}');
      const newData = {
        ...oldData,
        user: data.profile,
        account: data.account,
        loginMode: 'account',
        loginTime: Date.now(),
      };
      localStorage.setItem('data', JSON.stringify(newData));
      console.log('âœ… ç”¨æˆ·ä¿¡æ¯å·²ä¿å­˜');

      // åˆ·æ–°é¡µé¢
      console.log(
        '%cğŸ”„ 3ç§’åè‡ªåŠ¨åˆ·æ–°é¡µé¢...',
        'color: #42b883; font-size: 14px;'
      );
      setTimeout(() => {
        location.reload();
      }, 3000);
    } else if (data.code === 200 && !data.profile) {
      console.error(
        '%câŒ ç™»å½•å¤±è´¥: è´¦å·ä¿¡æ¯ä¸ºç©ºï¼ˆåŒ¿åç”¨æˆ·ï¼‰',
        'color: red; font-size: 14px;'
      );
      console.log('%cğŸ’¡ å¯èƒ½çš„åŸå› :', 'color: orange;');
      console.log('   1. Cookie å·²è¿‡æœŸ');
      console.log('   2. Cookie æ ¼å¼ä¸æ­£ç¡®');
      console.log('   3. Cookie è¢«ç½‘æ˜“äº‘æœåŠ¡å™¨æ‹’ç»');
      console.log('%cğŸ’¡ è§£å†³æ–¹æ¡ˆ: é‡æ–°è·å– Cookie', 'color: orange;');
    } else {
      console.error('%câŒ ç™»å½•å¤±è´¥:', 'color: red; font-size: 14px;');
      console.log('   é”™è¯¯ä»£ç :', data.code);
      console.log('   é”™è¯¯ä¿¡æ¯:', data.message || data.msg || 'æœªçŸ¥é”™è¯¯');
    }
  } catch (error) {
    console.error('%câŒ API è°ƒç”¨å¤±è´¥:', 'color: red; font-size: 14px;');
    console.error('   é”™è¯¯è¯¦æƒ…:', error.message);
    console.log('%cğŸ’¡ è¯·æ£€æŸ¥:', 'color: orange;');
    console.log('   1. API æœåŠ¡å™¨æ˜¯å¦æ­£å¸¸è¿è¡Œ');
    console.log('   2. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸');
    console.log('   3. æ§åˆ¶å°æ˜¯å¦æœ‰å…¶ä»–é”™è¯¯ä¿¡æ¯');
  }
})();
